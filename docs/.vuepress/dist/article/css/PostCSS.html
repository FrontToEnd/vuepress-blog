<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>PostCSS流程 | chuck</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="hi，我是chuck。一名F2Eer">
    <link rel="preload" href="/assets/css/0.styles.077cbd51.css" as="style"><link rel="preload" href="/assets/js/app.3f4decce.js" as="script"><link rel="preload" href="/assets/js/2.bdf3ae06.js" as="script"><link rel="preload" href="/assets/js/34.a835b6a0.js" as="script"><link rel="prefetch" href="/assets/js/10.eada5689.js"><link rel="prefetch" href="/assets/js/11.8c577c64.js"><link rel="prefetch" href="/assets/js/12.b6715b7f.js"><link rel="prefetch" href="/assets/js/13.910bf70c.js"><link rel="prefetch" href="/assets/js/14.68fc43ad.js"><link rel="prefetch" href="/assets/js/15.7cafe28c.js"><link rel="prefetch" href="/assets/js/16.eb15a660.js"><link rel="prefetch" href="/assets/js/17.79874611.js"><link rel="prefetch" href="/assets/js/18.2ab1affb.js"><link rel="prefetch" href="/assets/js/19.a392eb25.js"><link rel="prefetch" href="/assets/js/20.712152d5.js"><link rel="prefetch" href="/assets/js/21.2c108029.js"><link rel="prefetch" href="/assets/js/22.7de1fb97.js"><link rel="prefetch" href="/assets/js/23.538fba8a.js"><link rel="prefetch" href="/assets/js/24.678c9407.js"><link rel="prefetch" href="/assets/js/25.95daf731.js"><link rel="prefetch" href="/assets/js/26.06fc523b.js"><link rel="prefetch" href="/assets/js/27.7e0e331d.js"><link rel="prefetch" href="/assets/js/28.dc5b365e.js"><link rel="prefetch" href="/assets/js/29.9876fc9b.js"><link rel="prefetch" href="/assets/js/3.e38b8b6f.js"><link rel="prefetch" href="/assets/js/30.3c5f94d7.js"><link rel="prefetch" href="/assets/js/31.ff6971b6.js"><link rel="prefetch" href="/assets/js/32.4d4bceac.js"><link rel="prefetch" href="/assets/js/33.82501ef2.js"><link rel="prefetch" href="/assets/js/35.1c57dbf3.js"><link rel="prefetch" href="/assets/js/36.3f372679.js"><link rel="prefetch" href="/assets/js/37.1af4a03d.js"><link rel="prefetch" href="/assets/js/38.f1081cb6.js"><link rel="prefetch" href="/assets/js/39.fa03e4b7.js"><link rel="prefetch" href="/assets/js/4.3716397f.js"><link rel="prefetch" href="/assets/js/40.b860044e.js"><link rel="prefetch" href="/assets/js/41.86185343.js"><link rel="prefetch" href="/assets/js/42.0c0075b6.js"><link rel="prefetch" href="/assets/js/43.4e9ee742.js"><link rel="prefetch" href="/assets/js/44.65b2ce39.js"><link rel="prefetch" href="/assets/js/45.422be1f9.js"><link rel="prefetch" href="/assets/js/46.66c8b9f3.js"><link rel="prefetch" href="/assets/js/47.74e48322.js"><link rel="prefetch" href="/assets/js/48.866b5c4b.js"><link rel="prefetch" href="/assets/js/49.2331c42e.js"><link rel="prefetch" href="/assets/js/5.adc84131.js"><link rel="prefetch" href="/assets/js/50.01a479db.js"><link rel="prefetch" href="/assets/js/51.b46902c4.js"><link rel="prefetch" href="/assets/js/52.2e323837.js"><link rel="prefetch" href="/assets/js/53.04a399ba.js"><link rel="prefetch" href="/assets/js/54.392b71cd.js"><link rel="prefetch" href="/assets/js/55.1837e036.js"><link rel="prefetch" href="/assets/js/56.0900b3fe.js"><link rel="prefetch" href="/assets/js/57.94ca5c07.js"><link rel="prefetch" href="/assets/js/58.fdc2f5a1.js"><link rel="prefetch" href="/assets/js/59.da6b8b43.js"><link rel="prefetch" href="/assets/js/6.f4b3b355.js"><link rel="prefetch" href="/assets/js/60.2c6c08df.js"><link rel="prefetch" href="/assets/js/61.4bcf8e3a.js"><link rel="prefetch" href="/assets/js/62.6a815ac4.js"><link rel="prefetch" href="/assets/js/63.841a7f63.js"><link rel="prefetch" href="/assets/js/64.42844f28.js"><link rel="prefetch" href="/assets/js/65.6bb320a1.js"><link rel="prefetch" href="/assets/js/66.7f0781a0.js"><link rel="prefetch" href="/assets/js/67.9999f087.js"><link rel="prefetch" href="/assets/js/68.be67ff7c.js"><link rel="prefetch" href="/assets/js/69.270a4048.js"><link rel="prefetch" href="/assets/js/7.00249ed3.js"><link rel="prefetch" href="/assets/js/70.7e58fdde.js"><link rel="prefetch" href="/assets/js/71.737dc345.js"><link rel="prefetch" href="/assets/js/72.2d565df3.js"><link rel="prefetch" href="/assets/js/73.4cf51495.js"><link rel="prefetch" href="/assets/js/74.1aa0e1bf.js"><link rel="prefetch" href="/assets/js/75.e0e34199.js"><link rel="prefetch" href="/assets/js/76.82acf861.js"><link rel="prefetch" href="/assets/js/77.e589714d.js"><link rel="prefetch" href="/assets/js/78.8e9abadd.js"><link rel="prefetch" href="/assets/js/79.9e1fc178.js"><link rel="prefetch" href="/assets/js/8.703362e2.js"><link rel="prefetch" href="/assets/js/80.2a43e147.js"><link rel="prefetch" href="/assets/js/81.ca7bc668.js"><link rel="prefetch" href="/assets/js/82.c9e21c1b.js"><link rel="prefetch" href="/assets/js/83.a975c135.js"><link rel="prefetch" href="/assets/js/84.365e7338.js"><link rel="prefetch" href="/assets/js/85.64af8645.js"><link rel="prefetch" href="/assets/js/86.1b0bd26b.js"><link rel="prefetch" href="/assets/js/87.dde120f2.js"><link rel="prefetch" href="/assets/js/88.32dc5669.js"><link rel="prefetch" href="/assets/js/89.446a8227.js"><link rel="prefetch" href="/assets/js/9.7089b1f5.js"><link rel="prefetch" href="/assets/js/90.86e48091.js"><link rel="prefetch" href="/assets/js/91.d36166a4.js"><link rel="prefetch" href="/assets/js/92.2aa12fec.js">
    <link rel="stylesheet" href="/assets/css/0.styles.077cbd51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/img/logo.png" alt="chuck" class="logo"> <span class="site-name">chuck</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/" class="router-link-active">
          🍧首页
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/guide/">
          🏆规范
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/article/" class="router-link-active">
          📒文章
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/notes/">
          📚笔记
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/algorithm/">
          🌲算法
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          🌈联系
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/FrontToEnd/vuepress-blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目优化实践</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术体系</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术探索</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术总结</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue相关</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>CSS</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/css/filter和backdrop-filter.html" title="filter和backdrop-filter" class="sidebar-link">filter和backdrop-filter</a></li><li><a href="/article/css/css_property.html" title="CSS @property初探" class="sidebar-link">CSS @property初探</a></li><li><a href="/article/css/PostCSS.html" title="PostCSS流程" class="active sidebar-link">PostCSS流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/css/PostCSS.html#postcss的作用" title="PostCSS的作用" class="sidebar-link">PostCSS的作用</a></li><li class="sidebar-sub-header"><a href="/article/css/PostCSS.html#parse" title="parse" class="sidebar-link">parse</a></li><li class="sidebar-sub-header"><a href="/article/css/PostCSS.html#runplugin" title="runPlugin" class="sidebar-link">runPlugin</a></li><li class="sidebar-sub-header"><a href="/article/css/PostCSS.html#generate" title="generate" class="sidebar-link">generate</a></li><li class="sidebar-sub-header"><a href="/article/css/PostCSS.html#开发插件" title="开发插件" class="sidebar-link">开发插件</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>代码片段</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>资源收集</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂记</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="postcss流程"><a href="#postcss流程" class="header-anchor">#</a> PostCSS流程</h1> <h2 id="postcss的作用"><a href="#postcss的作用" class="header-anchor">#</a> PostCSS的作用</h2> <p><a href="https://postcss.org/" target="_blank" rel="noopener noreferrer">PostCSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>主要做了三件事：</p> <ol><li><code>parse</code>：把 CSS 文件的字符串解析成抽象语法树（Abstract Syntax Tree）的框架，解析过程中会检查 CSS 语法是否正确，不正确会给出错误提示。</li> <li><code>runPlugin</code>: 执行插件函数。PostCSS 本身不处理任何具体任务，它提供了以特定属性或者规则命名的事件。有特定功能的插件（如 <code>autoprefixer</code>、<code>CSS Modules</code>）会注册事件监听器。PostCSS 会在这个阶段，重新扫描 AST，执行注册的监听器函数。</li> <li><code>generate</code>: 插件对 AST 处理后，PostCSS 把处理过的 AST 对象转成 CSS string。</li></ol> <p>如果没有插件，那么初始传入的 CSS string 和 generate 生成的 CSS string 是一样的。</p> <h2 id="parse"><a href="#parse" class="header-anchor">#</a> parse</h2> <p>CSS 规则集（rule-set）由选择器和声明块组成：</p> <ul><li>选择器指向您需要设置样式的 HTML 元素。</li> <li>声明块包含一条或多条用分号分隔的声明。</li> <li>每条声明都包含一个 CSS 属性名称和一个值，以冒号分隔。</li> <li>多条 CSS 声明用分号分隔，声明块用花括号括起来。</li></ul> <p>AST 用五类对象描述 CSS 语法。这里举个具体的例子，再打印出对应的 AST 结果，对照了解 AST 五类对象和 CSS 语法的对应关系。</p> <p><code>app.css</code> 文件中写如下内容：</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>'./app-02.css'<span class="token punctuation">)</span></span><span class="token punctuation">;</span></span>

<span class="token selector">.container</span> <span class="token punctuation">{</span>
<span class="token property">  color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="declaration-对象"><a href="#declaration-对象" class="header-anchor">#</a> <strong><strong>Declaration 对象</strong></strong></h3> <p>Declaration 对象用来描述 CSS 中的每一条声明语句。</p> <ul><li>type 标记当前对象的类型</li> <li>parent 记录父对象的实例</li> <li>prop 记录声明中的属性名</li> <li>value 记录声明中的值</li> <li>raws 字段记录声明前的字符串、声明属性和值之间的符号的字符串</li> <li>其余字段解释见代码中的注释。</li></ul> <p>上边 CSS 文件中的<code>color: red;</code>会被描述成如下对象：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    parent<span class="token operator">:</span> Rule<span class="token punctuation">,</span>       <span class="token comment">// 外层的选择器被转译成 Rule 对象，是当前声明对象的 parent</span>
    prop<span class="token operator">:</span> <span class="token string">&quot;color&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// prop 字段记录声明的属性</span>
    raws<span class="token operator">:</span> <span class="token punctuation">{</span>             <span class="token comment">// raws 字段记录声明前、后的字符串，声明属性和值之间的字符串，以及前边语句是否分号结束。</span>
        before<span class="token operator">:</span> <span class="token string">'\n '</span><span class="token punctuation">,</span>  <span class="token comment">// raws.before 字段记录声明前的字符串</span>
        between<span class="token operator">:</span> <span class="token string">': '</span><span class="token punctuation">,</span> <span class="token comment">// raws.between 字段记录声明属性和值之间的字符串</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>          <span class="token comment">// source 字段记录声明语句的开始、结束位置，以及当前文件的信息</span>
        start<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        end<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> Input <span class="token punctuation">{</span>
            css<span class="token operator">:</span> <span class="token string">'@import url('</span><span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token operator">-</span><span class="token number">02.</span>css<span class="token string">');\n\n.container {\n  color: red;\n}'</span><span class="token punctuation">,</span>
            file<span class="token operator">:</span> <span class="token string">'/Users/admin/temp/postcss/app.css'</span><span class="token punctuation">,</span>
            hasBOM<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token function">Symbol</span><span class="token punctuation">(</span>fromOffsetCache<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isClean'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Symbol(isClean) 字段默认值都是 false，用于记录当前对象关联的 plugin 是否执行。plugin 会在后续解释</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Symbol(my) 字段默认值都是 true，用于记录当前对象是否是对应对象的实例，如果不是，可以根据类型把对象的属性设置为普通对象的 prototype 属性</span>
    type<span class="token operator">:</span> <span class="token string">'decl'</span><span class="token punctuation">,</span>            <span class="token comment">// type 记录对象类型，是个枚举值，声明语句的 type 固定是 decl</span>
    value<span class="token operator">:</span> <span class="token string">&quot;red&quot;</span>             <span class="token comment">// value 字段记录声明的值</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="rule-对象"><a href="#rule-对象" class="header-anchor">#</a> <strong><strong>Rule 对象</strong></strong></h3> <p>Rule 对象是描述选择器的。</p> <ul><li>type 记录对象的类型</li> <li>parent 记录父对象的实例</li> <li>nodes 记录子对象的实例</li> <li>selector 记录选择器的字符串</li> <li>raws 记录选择器前的字符串、选择器和大括号之间的字符串、最后一个声明和结束大括号之间的字符串</li> <li>其余字段解释见代码中的注释。</li></ul> <p>上边 app.css 文件中<code>.container</code>经过 postcss 转译后的对象是：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    nodes<span class="token operator">:</span> <span class="token punctuation">[</span>Declaration<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// nodes 记录包含关系，Rule 对象包含 Declaration 对象</span>
    parent<span class="token operator">:</span> Root<span class="token punctuation">,</span>        <span class="token comment">// 根对象是 Root 对象，是当前声明对象的 parent</span>
    raws<span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token comment">// raws 字段记录如下</span>
        before<span class="token operator">:</span> <span class="token string">'\n\n'</span><span class="token punctuation">,</span>  <span class="token comment">// raws.before 字段记录选择器前的字符串</span>
        between<span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>    <span class="token comment">// raws.between 字段记录选择器和大括号之间的字符串</span>
        semicolon<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// raws.semicolon 字段记录前置声明语句是正常分号结束</span>
        after<span class="token operator">:</span> <span class="token string">'\n'</span>      <span class="token comment">// raws.after 字段记录最后一个声明和结束大括号之间的字符串</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    selector<span class="token operator">:</span><span class="token string">'.container'</span><span class="token punctuation">,</span> <span class="token comment">// selector 记录 selector</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token comment">// source 字段记录选择器语句的开始、结束位置，以及当前文件的信息</span>
        start<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> Input <span class="token punctuation">{</span>
            css<span class="token operator">:</span> <span class="token string">'@import url('</span><span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token operator">-</span><span class="token number">02.</span>css<span class="token string">');\n\n.container {\n  color: red;\n}'</span><span class="token punctuation">,</span>
            file<span class="token operator">:</span> <span class="token string">'/Users/admin/temp/postcss/app.css'</span><span class="token punctuation">,</span>
            hasBOM<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token function">Symbol</span><span class="token punctuation">(</span>fromOffsetCache<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        end<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">57</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isClean'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Symbol(isClean) 字段默认值都是 false，用于记录当前对象关联的 plugin 是否执行。plugin 会在后续解释</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Symbol(my) 字段默认值都是 true，用于记录当前对象是否是对应对象的实例，如果不是，可以根据类型把对象的属性设置为普通对象的 prototype</span>
    type<span class="token operator">:</span> <span class="token string">'rule'</span>           <span class="token comment">// type 记录对象类型，是个枚举值，声明语句的 type 固定是 rule</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="root"><a href="#root" class="header-anchor">#</a> Root</h3> <p>Root 对象是 AST 对象的根对象。</p> <ul><li>type 记录当前对象的类型</li> <li>nodes 属性记录子节点对应对象的实例。</li></ul> <p>上边 app.css 文件中 root 对象是：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    nodes<span class="token operator">:</span> <span class="token punctuation">[</span>AtRule<span class="token punctuation">,</span> Rule<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// nodes 记录子对象（选择器和 @开头的对象），AtRule 对象会在后边提到</span>
    raws<span class="token operator">:</span> <span class="token punctuation">{</span>                <span class="token comment">// raws 字段记录如下</span>
        semicolon<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// raws.semicolon 最后是否是分号结束</span>
        after<span class="token operator">:</span> <span class="token string">''</span>          <span class="token comment">// raws.after 最后的空字符串</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token comment">// source 字段记录根目录语句的开始，以及当前文件的信息</span>
        start<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> Input <span class="token punctuation">{</span>
            css<span class="token operator">:</span> <span class="token string">'@import url('</span><span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token operator">-</span><span class="token number">02.</span>css<span class="token string">');\n\n.container {\n  color: red;\n}'</span><span class="token punctuation">,</span>
            file<span class="token operator">:</span> <span class="token string">'/Users/admin/temp/postcss/app.css'</span><span class="token punctuation">,</span>
            hasBOM<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token function">Symbol</span><span class="token punctuation">(</span>fromOffsetCache<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isClean'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Symbol(isClean) 字段默认值都是 false，用于记录当前对象关联的 plugin 是否执行。plugin 会在后续解释</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Symbol(my) 字段默认值都是 true，用于记录当前对象是否是对应对象的实例，如果不是，可以根据类型把对象的属性设置为普通对象的 prototype</span>
    type<span class="token operator">:</span> <span class="token string">'root'</span>           <span class="token comment">// type 记录对象类型，是个枚举值，声明语句的 type 固定是 root</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="atrule-对象"><a href="#atrule-对象" class="header-anchor">#</a> <strong><strong>AtRule 对象</strong></strong></h3> <p>CSS 中除了选择器，还有一类语法是 <code>@</code> 开头的，例如 <code>@import</code>、<code>@keyframes</code>、<code>@font-face</code>，PostCSS 把这类语法解析成 AtRule 对象。</p> <ul><li>type 记录当前对象的类型</li> <li>parent 记录当前对象的父对象</li> <li>name 记录<code>@</code>紧跟着的单词</li> <li>params 记录 name 值</li></ul> <p>例如 <code>@import url(&quot;./app-02.css&quot;);</code> 将被解析成如下对象：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;import&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">// name 记录 @ 紧跟着的单词</span>
    params<span class="token operator">:</span> <span class="token string">&quot;url('./app-02.css')&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// params 记录 name 值</span>
    parent<span class="token operator">:</span> Root<span class="token punctuation">,</span>                    <span class="token comment">// parent 记录父对象</span>
    raws<span class="token operator">:</span> <span class="token punctuation">{</span>                          <span class="token comment">// raws 字段记录如下</span>
        before<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                  <span class="token comment">// raws.before 记录 @语句前的空字符串</span>
        between<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                 <span class="token comment">// raws.between 记录 name 和 { 之间的空字符串</span>
        afterName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                <span class="token comment">// raws.afterName 记录 name 和 @ 语句之间的空字符串</span>
        after<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                   <span class="token comment">// raws.after 记录大括号和上一个 rule 之间的空字符串</span>
        semicolon<span class="token operator">:</span> <span class="token boolean">false</span>             <span class="token comment">// raws.semicolon 上一个规则是否是分号结束</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>                        <span class="token comment">// source 字段记录@语句的开始，以及当前文件的信息</span>
        start<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        end<span class="token operator">:</span> <span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span> column<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> line<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        input<span class="token operator">:</span> Input <span class="token punctuation">{</span>
            css<span class="token operator">:</span> <span class="token string">'@import url('</span><span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token operator">-</span><span class="token number">02.</span>css<span class="token string">');\n\n.container {\n  color: red;\n}'</span><span class="token punctuation">,</span>
            file<span class="token operator">:</span> <span class="token string">'/Users/admin/temp/postcss/app.css'</span><span class="token punctuation">,</span>
            hasBOM<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token function">Symbol</span><span class="token punctuation">(</span>fromOffsetCache<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isClean'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Symbol(isClean) 字段默认值都是 false，用于记录当前对象关联的 plugin 是否执行。plugin 会在后续解释</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Symbol(my) 字段默认值都是 true，用于记录当前对象是否是对应对象的实例，如果不是，可以根据类型把对象的属性设置为普通对象的 prototype</span>
    type<span class="token operator">:</span> <span class="token string">'atrule'</span>          <span class="token comment">// type 记录对象类型，是个枚举值，声明语句的 type 固定是 atrule</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="comment-对象"><a href="#comment-对象" class="header-anchor">#</a> <strong><strong>Comment 对象</strong></strong></h3> <p>css 文件中的注释被解析成 Comment 对象。text 字段记录注释内容。<code>/* 你好 */</code>
被解析成：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
    parent<span class="token operator">:</span> Root<span class="token punctuation">,</span>             <span class="token comment">// parent 记录父对象</span>
    raws<span class="token operator">:</span> <span class="token punctuation">{</span>                   <span class="token comment">// raws 字段记录如下</span>
        before<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>           <span class="token comment">// raws.before 记录注释语句前的空字符串</span>
        left<span class="token operator">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>            <span class="token comment">// raws.left 记录注释语句左侧的空字符串</span>
        right<span class="token operator">:</span> <span class="token string">' '</span>            <span class="token comment">// raws.right 记录注释语句右侧的空字符串</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    source<span class="token operator">:</span> <span class="token punctuation">{</span>                 <span class="token comment">// source 字段记录注释语句的开始、结束位置，以及当前文件的信息</span>
        start<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span><span class="token punctuation">,</span> input<span class="token operator">:</span> Input<span class="token punctuation">,</span> end<span class="token operator">:</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'isClean'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// Symbol(isClean) 字段默认值都是 false，用于记录当前对象关联的 plugin 是否执行。plugin 会在后续解释</span>
    <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'my'</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token comment">// Symbol(my) 字段默认值都是 true，用于记录当前对象是否是对应对象的实例，如果不是，可以根据类型把对象的属性设置为普通对象的 prototype</span>
    text<span class="token operator">:</span> <span class="token string">'你好'</span><span class="token punctuation">,</span>             <span class="token comment">// text 记录注释内容</span>
    type<span class="token operator">:</span> <span class="token string">'comment'</span>          <span class="token comment">// type 记录对象类型，是个枚举值，声明语句的 type 固定是 comment</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="关系"><a href="#关系" class="header-anchor">#</a> 关系</h3> <p>从上一段可以知道，CSS 被解析成 Declaration、Rule、Root、AtRule、Comment 对象。这些对象有很多公共方法，PostCSS 用了面向对象的继承思想，把公共方法和公共属性提取到了父类中。</p> <p>Root、Rule、AtRule 都是可以有子节点的，都有 nodes 属性，他们三个继承自 Container 类，对 nodes 的操作方法都写在 Container 类中。Container、Declaration、Comment 继承自 Node 类，所有对象都有 Symbol('isClean')、Symbol('my')、raws、source、type 属性，都有toString()、error()等方法，这些属性和方法都定义在 Node 类中。</p> <p>把CSS转换为AST的源码位置是：<a href="https://github.com/postcss/postcss/blob/main/lib/parser.js#L33" target="_blank" rel="noopener noreferrer">postcss/lib/parser.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的<code>parse</code>方法。</p> <h2 id="runplugin"><a href="#runplugin" class="header-anchor">#</a> <strong>runPlugin</strong></h2> <p>PostCSS 本身并不处理任何具体的任务，只有当我们为其附加各种插件之后，它才具有实用性。</p> <p>PostCSS 在把 CSS string 解析成 AST 对象后，会扫描一边 AST 对象，每一种 AST 的对象都可以有对应的监听器。在遍历到某类型的对象时，如果有对象的监听器，就会执行其监听器。</p> <h3 id="第一类监听器"><a href="#第一类监听器" class="header-anchor">#</a> <strong>第一类监听器</strong></h3> <p>PostCSS 提供的**「以特定属性或者规则命名」**的事件监听器，如下：</p> <p>CHILDREAN 代表子节点的事件监听器。</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// root</span>
<span class="token punctuation">[</span><span class="token string">'Root'</span><span class="token punctuation">,</span> <span class="token constant">CHILDREN</span><span class="token punctuation">,</span> <span class="token string">'RootExit'</span><span class="token punctuation">]</span>

<span class="token comment">// AtRule</span>
<span class="token punctuation">[</span><span class="token string">'AtRule'</span><span class="token punctuation">,</span> <span class="token string">'AtRule-import'</span><span class="token punctuation">,</span> <span class="token constant">CHILDREN</span><span class="token punctuation">,</span> <span class="token string">'AtRuleExit'</span><span class="token punctuation">,</span> <span class="token string">'AtRuleExit-import'</span><span class="token punctuation">]</span>

<span class="token comment">// Rule</span>
<span class="token punctuation">[</span><span class="token string">'Rule'</span><span class="token punctuation">,</span> <span class="token constant">CHILDREN</span><span class="token punctuation">,</span> <span class="token string">'RuleExit'</span><span class="token punctuation">]</span>

<span class="token comment">// Declaration</span>
<span class="token punctuation">[</span><span class="token string">'Declaration'</span><span class="token punctuation">,</span> <span class="token string">'Declaration-color'</span><span class="token punctuation">,</span> <span class="token string">'DeclarationExit'</span><span class="token punctuation">,</span> <span class="token string">'DeclarationExit-color'</span><span class="token punctuation">]</span>

<span class="token comment">// Comment</span>
<span class="token punctuation">[</span><span class="token string">'Comment'</span><span class="token punctuation">,</span> <span class="token string">'CommentExit'</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>PostCSS 以深度优先的方式遍历 AST 树。</p> <ul><li>遍历到 Root 根对象，第一步会执行所有插件注册的 Root 事件监听器，第二步检查 Root 是否有子对象，如果有，则遍历子对象，执行子对象对应的事件监听器；如果没有子对象，则直接进入第三步，第三步会执行所有插件注册的 RootExit 事件监听器。插件注册的 Root、RootExit 事件的监听器只能是函数。函数的第一个参数是当前访问的 AST 的 Root 对象，第二个参数是 postcss 的 Result 对象和一些其他属性，通过 Result 对象可以获取 css string、opts 等信息。</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
<span class="token function-variable function">  Root</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>rootNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">  RootExit</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>rootNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>遍历到 Rule 对象，则和访问 Root 根对象是一样的逻辑，先执行所有插件注册的 Rule 事件监听器，再遍历子对象，最后执行所有插件注册的 RuleExit 事件监听器。插件注册的 Rule、RuleExit 事件的监听器只能是函数。</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
<span class="token function-variable function">  Rule</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>ruleNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">  RuleExit</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>ruleNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>遍历到 AtRule 对象。插件注册的 AtRule 的事件监听器可以是函数，也可以是对象。对象类型的监听器，对象属性的 key 是 AtRule 对象的 name 值，value 是函数。AtRuleExit 是一样的逻辑。事件的执行顺序是：<code>['AtRule', 'AtRule-import', CHILDREN, 'AtRuleExit', 'AtRuleExit-import']</code>。CHILDREAN 代表子节点的事件。``` // 函数 { AtRule: (atRuleNode, helps) =&gt; {} }</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 对象</span>
<span class="token punctuation">{</span>
  AtRule<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token function-variable function">      import</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>atRuleNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">      keyframes</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>atRuleNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>遍历到 Declaration 对象。插件注册的 Declaration 的事件监听器可以是函数，也可以是对象，对象属性的 key 是 Declaration 对象的 prop 值，value 是函数。DeclarationExitExit 是一样的逻辑。事件的执行顺序是：<code>['Declaration', 'Declaration-color', 'DeclarationExit', 'DeclarationExit-color']</code>。Declaration 没有子对象，只需要执行当前对象的事件，不需要深度执行子对象的事件。</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token comment">// 函数</span>
<span class="token punctuation">{</span>
<span class="token function-variable function">  Declaration</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>declarationNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对象</span>
<span class="token punctuation">{</span>
  Declaration<span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token function-variable function">      color</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>declarationNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">      border</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>declarationNode<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li>遍历到 Comment 对象。依次执行所有插件注册的 Comment 事件监听器，再执行所有插件注册的 CommentExit 事件监听器。</li></ul> <h3 id="第二类监听器"><a href="#第二类监听器" class="header-anchor">#</a> <strong>第二类监听器</strong></h3> <p>除以特定属性或者规则命名的事件监听器，PostCSS 还有以下四个：</p> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  postcssPlugin<span class="token operator">:</span> string<span class="token punctuation">,</span>
<span class="token function-variable function">  prepare</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">  Once</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">  OnceExit</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>PostCSS 插件事件的整体执行是：<code>[prepare, Once, ...一类事件，OnceExit]</code>，postcssPlugin 是插件名称，不是事件监听器。</p> <ul><li>postcssPlugin：字符串类型，插件的名字，在插件执行报错，提示用户是哪个插件报错了。</li> <li>prepare：函数类型，prepare 是最先执行的，在所有事件执行前执行的，插件多个监听器间共享数据时使用。prepare 的入参是 Result 对象，返回值是监听器对象，通过 Result 对象可以获取 css string、opts 等信息。</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  postcssPlugin<span class="token operator">:</span> <span class="token string">&quot;PLUGIN NAME&quot;</span><span class="token punctuation">,</span>
<span class="token function">  prepare</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> variables <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
<span class="token function">      Declaration</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token function"> </span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">.</span>variable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          variables<span class="token punctuation">[</span>node<span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> node<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">      OnceExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>variables<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>Once：函数类型，在 prepare 后，一类事件前执行，Once 只会执行一次。</li></ul> <div class="language-jsx line-numbers-mode"><pre class="language-jsx"><code><span class="token punctuation">{</span>
<span class="token function-variable function">   Once</span><span class="token operator">:</span><span class="token function"> </span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> helps<span class="token punctuation">)</span><span class="token parameter"> </span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>OnceExit: 函数类型，在一类事件后执行，OnceExit 只会执行一次。</li></ul> <h2 id="generate"><a href="#generate" class="header-anchor">#</a> <strong>generate</strong></h2> <p>generate 的过程依旧是以深度优先的方式遍历 AST 对象，针对不同的实例对象进行字符串的拼接。算法对应源码中位置是：<a href="https://github.com/postcss/postcss/blob/main/lib/stringifier.js#L27" target="_blank" rel="noopener noreferrer">postcss/lib/stringifier.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中的<code>stringify</code>方法。</p> <h2 id="开发插件"><a href="#开发插件" class="header-anchor">#</a> 开发插件</h2> <p><a href="https://github.com/postcss/postcss/blob/main/docs/writing-a-plugin.md" target="_blank" rel="noopener noreferrer">writing-a-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/FrontToEnd/vuepress-blog/edit/main/article/css/PostCSS.md" target="_blank" rel="noopener noreferrer">帮助我改善这个页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2/25/2022, 4:39:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/article/css/css_property.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        CSS @property初探
      </a></span> <span class="next"><a href="/article/code/code_fragment.html">
        代码片段整理
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.3f4decce.js" defer></script><script src="/assets/js/2.bdf3ae06.js" defer></script><script src="/assets/js/34.a835b6a0.js" defer></script>
  </body>
</html>